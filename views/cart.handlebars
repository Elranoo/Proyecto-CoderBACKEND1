<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mi Carrito</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<h1>Mi Carrito</h1>

{{#if productos.length}}
  <div id="cartContainer">
    {{#each productos}}
      <div class="product-card">
        <h3>{{this.product.title}}</h3>
        <p>Cantidad: {{this.quantity}}</p>
        <p>Precio unitario: ${{this.product.price}}</p>
        <p>Subtotal: ${{multiply this.product.price this.quantity}}</p>
        <button class="delete-btn" onclick="eliminarProducto('{{this.product._id}}')">Eliminar</button>
      </div>
    {{/each}}

    <h2>Total: ${{calcularTotal productos}}</h2>
  </div>
{{else}}
  <p>El carrito está vacío.</p>
{{/if}}

<script>
  const cartId = '{{_id}}';

  async function eliminarProducto(productId) {
    try {
      const res = await fetch(`/api/carts/${cartId}/products/${productId}`, { method: 'DELETE' });
      const data = await res.json();
      if (res.ok) location.reload();
      else alert(data.mensaje || 'Error al eliminar producto');
    } catch (err) {
      alert('Error al eliminar producto del carrito');
    }
  }
</script>
</body>
</html>